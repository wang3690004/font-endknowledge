###图解http
#### 前言
关于http相关的概念一直都不是很明白，打算重新梳理复习一下http(s) 相关的计算机网络知识,通过这本书以及后续其他学习，由浅入深了解计算机网络

1. 网络基础tcp/ip
tcp/ip有着分层管理，并且从上到下分为四层:应用层、传输层、网络层、数据链路层。把tcp/ip 层次化是有好处的，如果互联网只有一个协议统筹，某个地方需要改变的时候 就必须把所有部分都替换掉，分层之后层层封装 只需要把有变动的改变就可以了，和我们封装代码的道理是相似的。
1.1 应用层， 应用层决定了向用户提供应用级服务通信的活动，这一层有各类通用的应用服务，ftp，http dns等
1.2 传输层，是应用层的下层，主要提供处于网络连接中的两台计算机之间的数据传输，再tcp传输层有两个不哦她那个的协议tcp(传输控制协议)),udp(用户数据报文),经典的问题,tcp三四握手 四次挥手 udp的缺点等等 
1.3 网络层(网络互连层),网络层用来处理再网络上流动的数据包，数据包是网络传输的最小数据单位，该层规定了通过怎样的路径(路由)到达对方计算机，典型的问题 ip 路由 等
1.4 链路层(数据链路层，网络接口层),用来处理连接网络的硬件部分

![](../src/imgs/图解http1.png)

tcp/ip协议进行网络通信时会通过分层顺序与对方进行通信，发送端从应用层往下走 服务端网上，反过来一样
，为了方便传输在传输层tcp把从应用收到的数据进行分割并在各个报文打上序号标记及端口号转发给网络层， 在网络层 增加作为通信目的地的mac地址 后转发给链路层。 在传输数据的过程中 每经过一层必定会呗打上一个该层所属的首部信息，反之在接收层层传输时，会逐层的吧首部去掉

2. ip tcp dns关系
  按层次分,ip属于网络层，ip协议的作用就是指明了两个地址，用来指向数据要传送的地址，就是地址ip,mac，ip地址指明了节点被分配到的地址，mac地址指的是网卡所属的固定地址，ip地址可以和mac地址进行配对，ip可以换，但是mac地址基本不会变。
  而数据数据的传送主要靠路由器或交换机进行分段传送。这个过程就是路由选择 

  3. tcp的三次握手 四次挥手
   按层次分 tcp 位于传输层，提供可靠的字节流服务(为了方便传输将大块数据分割成以报文段为单位的数据包进行管理，而可靠的传输服务是指数据可以准确的发送过去)，巍峨了准确将数据送到,tcp就用到了三次握手 四次挥手的功能了。握手过程中使用了tcp标志，flag syn(synchronize同步) ack(acknowledegment,确认)
   ![](../src/imgs/图解http2.png)

    第一次握手: 建立连接时，客户端发送sync包(x) 到服务器，并进入 syn_sent 同步请求状态 等待服务器确认
    第二次握手: 服务器收到sync包，必须确认客户的sync值(x+1)，同时自己发送一个sync包(y)， 此时服务器进入syn_recv状态
    第三次握手： 客户端收到服务器的syn，ack包，同时向服务器发送确认包ack(y+1)  证明客户端安全接受同步确认包 双方都进入  established状态 完成三次握手

 为什么不用两次握手?
 解：3次握手主要完成两个重要功能，既要双方做好发送数据的准备工作(双方都知道彼此已经准备好),也要允许双方就初始序列号进行协商，这个序列号在握手过程中被发送和确认
  选择把三次握手改成两次，死锁可能发生的，考虑计算机客户端(c)和服务器(s)之间的通信,假设c给s发送一个连接请求，s收到了这个请求 并发送了确认应答，按照两次握手得协定，s认为连接已经成功了 便开始发送数据，可是c在s答应请求运输得情况下 如果出了问题那就会出现这样一种场景，c不知道s是否已经准备好，也不知道s建立了什么样得序列号，c甚至怀疑s是否收到了自己得请求，在这种情况下c认为连接还未建立成功，会忽略s发来得任何数据，只等连接确认 而s在发出得数据超时后会继续发重复得数据 这样就出了问题了。 c端不确认建立连接，中途如果收到其他得s发送得数据 没有办法回应，会出现丢数据得问题

如果已经建立了链接 但是客户端发生了故障怎么办？
解： 客户端如果出现故障，服务器也不会一直等下去，服务器每收到一次客户端得请求后都会重新复位一个计时器，这个计时器通常设置为2h，2h之后还是没有收到客户端得任何数据，服务器就会发送一个探测报文段，以后每隔75s 发送一次 若是发送10个都没反应 那么就关闭了链接
    
   
   