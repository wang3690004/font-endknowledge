####前端跨域


jsonp 
 1. 一个众所周知的问题，ajax直接请求普通文件会存在跨域无法访问的问题。对于网页而言存在一种情况是JavaScript的src的请求不存在跨域的问题，即浏览器同源策略是允许script标签的，所以可以使用jsonp的方案来进行跨域请求。
    具体的过程1. 前端设置好回调函数，并把回调函数当作请求url携带的参数。 2. 后端接受请求后，返回回调函数名和需要的数据， 3.后端响应并返回数据后，返回的数据传入到回调函数种并执行

> \<script > var locahanlder = function(data){ alert(data)} </script>
 \<script src = 'http://remoteserver/remote.js'></script>

 请求的这个js 直接返回 localhanlder({result:'aa'}) 这样就可以直接执行了
但是这里还有一个问题，就是这里完完全全就是静态请求的，而服务端可能会存在多个服务，如何让远程js知道应该调用本地函数的名字叫什么？ 
   这里有一个办法就是 在客户端动态生成一个script 同时script请求的url 带着需要请求的数据和需要本地调用的方法，这样后端获取url之后去做字符串的拼接，这样就可以解决问题了

> \<script > var locahanlder = function(data){ alert(data)} 
    var url ='http://flightquery.com/jsonp/flightresult.js?code =requestdata&callback=flighthandler'
    var script=document.createElement('script')
    script.setAttribute('src',url)
    document.getElementByTagName('head')[0].appendChild(script)
 \</script>

 这样实现编码的动态查询，也这是jsonp客户端实现的核心部分，url传递一个code参数，告诉服务器要请求的信息，而callback告诉服务器，为的本地回调函数脚flighthandler,所以请把查询结构传入这个函数中进行调用，
 所以服务器 返回一段执行回调函数  flightHanlder({result})

要注意的是 ： jsonp因为是请求 ，所以只能使用get 而不能用post等方式， 它和ajax本质上是不同的东西，ajax的核心是通过xmlhttprequest获取非本页内容，而jsonp的核心是动态添加js   无法检测jsonp请求是否失败；  可能存在安全隐患，josnp 如果服务器返回一些危险的代码那么可能会危害页面安全